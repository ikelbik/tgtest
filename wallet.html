<!DOCTYPE html>
<html>
<head>
    <meta name="telegram:verify" content="VERIFICATION_CODE_OT_BOTFATHER">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">	
    <link rel="manifest" href="https://ikelbik.github.io/tgtest/app-manifest.json">
    <link rel="icon" type="image/png" href="https://ikelbik.github.io/tgtest/favicon.png">    
    <meta charset="UTF-8">
    <meta name="theme-color" content="#000022">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <style>
        * { margin: 0; padding: 0; overflow: hidden; -webkit-tap-highlight-color: transparent; touch-action: none }
        body { background: #000022 }
        html, body, #game-container {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #4a6fff, #2a4fff);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(74, 111, 255, 0.4);
            transition: all 0.3s ease;
        }
        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(74, 111, 255, 0.6);
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="window.location.href='index.html'">‚Üê</button>
    <div id="game"></div>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram?.WebApp;
        
        if (tg) {
            tg.ready();
            tg.expand();
        }

        class WalletScene extends Phaser.Scene {
            constructor() {
                super({ key: 'WalletScene' });
                this.balance = 12450; // –ü—Ä–∏–º–µ—Ä –±–∞–ª–∞–Ω—Å–∞
                this.transactions = [
                    { type: 'income', amount: 150, description: '–§–∞—Ä–º–∏–Ω–≥ –º–æ–Ω–µ—Ç', time: '2 –º–∏–Ω –Ω–∞–∑–∞–¥' },
                    { type: 'income', amount: 500, description: '–°–µ–π—Ñ —É—Ä–æ–≤–Ω—è 2', time: '15 –º–∏–Ω –Ω–∞–∑–∞–¥' },
                    { type: 'expense', amount: 100, description: '–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ–π—Ñ–∞', time: '20 –º–∏–Ω –Ω–∞–∑–∞–¥' },
                    { type: 'income', amount: 75, description: '–§–∞—Ä–º–∏–Ω–≥ –º–æ–Ω–µ—Ç', time: '1 —á–∞—Å –Ω–∞–∑–∞–¥' },
                    { type: 'income', amount: 300, description: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞', time: '2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥' }
                ];
            }

            preload() {
                this.load.setBaseURL('https://ikelbik.github.io/tgtest');
                this.load.image('coin_icon', 'assets/coin_t0.png');
                this.load.audio('coinSound', 'assets/up.mp3');
                this.load.atlas('flares', 'assets/flares.png', 'assets/flares.json');
            }

            create() {
                this.cameras.main.setBackgroundColor('#000022');
                
                // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
                this.createBackground();
                
                // –°–æ–∑–¥–∞–µ–º –ø–ª–∞–≤–∞—é—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã
                this.createBackgroundParticles();
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                this.createTitle();
                
                // –ö–∞—Ä—Ç–æ—á–∫–∞ –±–∞–ª–∞–Ω—Å–∞
                this.createBalanceCard();
                
                // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                this.createActionButtons();
                
                // –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                this.createTransactionHistory();
                
                if (tg) {
                    tg.MainButton.hide();
                    tg.onEvent('backButtonClicked', () => {
                        window.location.href = 'index.html';
                    });
                }
            }
            
            createBackground() {
                const graphics = this.add.graphics();
                const centerX = this.cameras.main.centerX;
                const centerY = this.cameras.main.centerY;
                const radius = Math.max(this.cameras.main.width, this.cameras.main.height);
                
                for (let i = 0; i < radius; i += 10) {
                    const alpha = 1 - (i / radius) * 0.8;
                    const color = Phaser.Display.Color.Interpolate.ColorWithColor(
                        { r: 20, g: 40, b: 80 },
                        { r: 0, g: 0, b: 34 },
                        100,
                        Math.floor((i / radius) * 100)
                    );
                    
                    graphics.fillStyle(Phaser.Display.Color.GetColor(color.r, color.g, color.b), alpha);
                    graphics.fillCircle(centerX, centerY, radius - i);
                }
            }
            
            createBackgroundParticles() {
                for (let i = 0; i < 20; i++) {
                    const particle = this.add.circle(
                        Phaser.Math.Between(0, this.cameras.main.width),
                        Phaser.Math.Between(0, this.cameras.main.height),
                        Phaser.Math.Between(2, 5),
                        0xffd700,
                        0.3
                    );
                    
                    this.tweens.add({
                        targets: particle,
                        y: particle.y + Phaser.Math.Between(-60, 60),
                        x: particle.x + Phaser.Math.Between(-30, 30),
                        alpha: { from: 0.1, to: 0.5 },
                        duration: Phaser.Math.Between(5000, 10000),
                        ease: 'Sine.easeInOut',
                        yoyo: true,
                        repeat: -1,
                        delay: Phaser.Math.Between(0, 4000)
                    });
                }
            }
            
            createTitle() {
                const title = this.add.text(this.cameras.main.centerX, 120, 'üí∞ –ö–û–®–ï–õ–ï–ö', { 
                    fontSize: '48px', 
                    fill: '#ffd700',
                    fontStyle: 'bold',
                    stroke: '#000044',
                    strokeThickness: 6,
                    shadow: {
                        offsetX: 3,
                        offsetY: 3,
                        color: '#000000',
                        blur: 10,
                        fill: true
                    }
                }).setOrigin(0.5);
                
                this.tweens.add({
                    targets: title,
                    scale: { from: 1, to: 1.05 },
                    duration: 2500,
                    ease: 'Sine.easeInOut',
                    yoyo: true,
                    repeat: -1
                });
                
                title.setAlpha(0);
                this.tweens.add({
                    targets: title,
                    alpha: 1,
                    duration: 1000,
                    ease: 'Power2.easeOut'
                });
            }
            
            createBalanceCard() {
                const cardWidth = this.cameras.main.width - 80;
                const cardHeight = 180;
                const cardX = this.cameras.main.centerX;
                const cardY = 280;
                
                // –§–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                const cardBg = this.add.graphics();
                cardBg.fillGradientStyle(0x2a4fff, 0x2a4fff, 0x1a3eee, 0x1a3eee, 1);
                cardBg.fillRoundedRect(cardX - cardWidth/2, cardY - cardHeight/2, cardWidth, cardHeight, 20);
                cardBg.lineStyle(3, 0x4a6fff, 0.8);
                cardBg.strokeRoundedRect(cardX - cardWidth/2, cardY - cardHeight/2, cardWidth, cardHeight, 20);
                
                // –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è
                const glow = this.add.graphics();
                glow.fillStyle(0x4a6fff, 0.3);
                glow.fillRoundedRect(cardX - cardWidth/2 - 5, cardY - cardHeight/2 - 5, cardWidth + 10, cardHeight + 10, 25);
                
                this.tweens.add({
                    targets: glow,
                    alpha: { from: 0.2, to: 0.5 },
                    duration: 2000,
                    ease: 'Sine.easeInOut',
                    yoyo: true,
                    repeat: -1
                });
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–∞–ª–∞–Ω—Å–∞
                const balanceLabel = this.add.text(cardX, cardY - 40, '–¢–ï–ö–£–©–ò–ô –ë–ê–õ–ê–ù–°', {
                    font: '20px Arial',
                    fill: '#ffffff',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // –°—É–º–º–∞ –±–∞–ª–∞–Ω—Å–∞
                this.balanceText = this.add.text(cardX, cardY + 10, this.formatNumber(this.balance), {
                    font: '42px Arial',
                    fill: '#ffd700',
                    fontStyle: 'bold',
                    stroke: '#000000',
                    strokeThickness: 4
                }).setOrigin(0.5);
                
                // –ò–∫–æ–Ω–∫–∞ –º–æ–Ω–µ—Ç—ã
                const coinIcon = this.add.text(cardX + 120, cardY + 10, 'ü™ô', {
                    font: '36px Arial'
                }).setOrigin(0.5);
                
                this.tweens.add({
                    targets: coinIcon,
                    rotation: { from: 0, to: Math.PI * 2 },
                    duration: 4000,
                    repeat: -1,
                    ease: 'Linear'
                });
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
                const cardElements = [cardBg, glow, balanceLabel, this.balanceText, coinIcon];
                cardElements.forEach(element => {
                    element.setAlpha(0);
                    element.y += 30;
                });
                
                this.tweens.add({
                    targets: cardElements,
                    alpha: 1,
                    y: '-=30',
                    duration: 800,
                    delay: 500,
                    ease: 'Back.easeOut'
                });
            }
            
            createActionButtons() {
                const buttonData = [
                    { text: 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å', color: 0xff4444, action: 'send' },
                    { text: 'üì• –ü–æ–ª—É—á–∏—Ç—å', color: 0x44ff44, action: 'receive' },
                    { text: 'üîÑ –û–±–º–µ–Ω—è—Ç—å', color: 0x4444ff, action: 'exchange' }
                ];
                
                const buttonWidth = 140;
                const buttonHeight = 80;
                const spacing = 20;
                const totalWidth = buttonData.length * buttonWidth + (buttonData.length - 1) * spacing;
                const startX = this.cameras.main.centerX - totalWidth / 2 + buttonWidth / 2;
                const y = 450;
                
                this.coinSound = this.sound.add('coinSound', { volume: 0.6 });
                
                buttonData.forEach((data, index) => {
                    const x = startX + index * (buttonWidth + spacing);
                    const button = this.createActionButton(x, y, buttonWidth, buttonHeight, data);
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                    button.setAlpha(0);
                    button.y += 50;
                    this.tweens.add({
                        targets: button,
                        alpha: 1,
                        y: y,
                        duration: 600,
                        delay: 800 + index * 150,
                        ease: 'Back.easeOut'
                    });
                });
            }
            
            createActionButton(x, y, width, height, data) {
                const container = this.add.container(x, y);
                
                // –§–æ–Ω –∫–Ω–æ–ø–∫–∏
                const buttonBg = this.add.graphics();
                buttonBg.fillStyle(data.color, 0.8);
                buttonBg.fillRoundedRect(-width/2, -height/2, width, height, 15);
                buttonBg.lineStyle(2, 0xffffff, 0.6);
                buttonBg.strokeRoundedRect(-width/2, -height/2, width, height, 15);
                
                // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                const buttonText = this.add.text(0, 0, data.text, {
                    font: '18px Arial',
                    fill: '#ffffff',
                    fontStyle: 'bold',
                    align: 'center'
                }).setOrigin(0.5);
                
                container.add([buttonBg, buttonText]);
                
                // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                const hitArea = new Phaser.Geom.Rectangle(-width/2, -height/2, width, height);
                container.setInteractive(hitArea, Phaser.Geom.Rectangle.Contains);
                
                container.on('pointerover', () => {
                    this.tweens.add({
                        targets: container,
                        scale: 1.05,